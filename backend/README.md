# Data Analysis Backend

This backend implements a three-layer architecture for data analysis:

1. **API Layer** - Handles session management and request routing
2. **Execution Layer** - Executes the actual analysis in isolated Docker containers

## Directory Structure

```
backend/
├── api_layer/             # API Layer components
│   ├── __init__.py
│   ├── api_server.py      # API server implementation
│   └── session_manager.py # Session management
├── execution_layer/       # Execution Layer components
│   ├── __init__.py
│   ├── data_analysis_agent.py  # Main analysis agent
│   ├── eda_agent.py            # Exploratory data analysis
│   ├── execution_api.py        # API for execution container
│   ├── hypothesis_agent.py     # Hypothesis generation
│   ├── narrator_agent.py       # Report generation
│   └── run_execution_api.py    # Entry point for container
├── input_data/            # Input data files
├── output_data/           # Output files generated by analysis
├── Dockerfile             # Docker image for execution containers
├── logger.py              # Shared logging module
├── main.py                # Main entry point for API server
└── requirements.txt       # Python dependencies
```

## How It Works

1. **API Layer**:
   - Manages Docker containers for isolated execution environments
   - Routes requests to the appropriate execution container
   - Handles session management and persistence

2. **Execution Layer**:
   - Runs inside Docker containers
   - Executes data analysis workflows
   - Generates reports and visualizations

## Setup and Running

### Building the Docker Image

```bash
cd backend
docker build -t code-execution-env .
```

### Starting the API Server

```bash
cd backend
python main.py
```

## API Endpoints

- `GET /hello` - Simple health check
- `GET /session_id` - Create a new session
- `GET /validate_session/<container_id>` - Validate if a session exists
- `GET /session_status/<container_id>` - Get status of a session
- `POST /cleanup_session/<container_id>` - Clean up a session
- `GET /logs` - Stream logs
- `POST /analyze` - Run analysis with a query 